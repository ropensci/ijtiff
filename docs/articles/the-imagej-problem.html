<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The <em>ImageJ</em> Problem • ijtiff</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="The &lt;em&gt;ImageJ&lt;/em&gt; Problem">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ijtiff</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.5.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reading-and-writing-images.html">Reading and Writing Images</a>
    </li>
    <li>
      <a href="../articles/text-images.html">Text Images</a>
    </li>
    <li>
      <a href="../articles/the-imagej-problem.html">The _ImageJ_ Problem</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>The <em>ImageJ</em> Problem</h1>
            
            <h4 class="date">2018-10-31</h4>
      
      
      <div class="hidden name"><code>the-imagej-problem.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>The <em>ImageJ</em> software (<a href="https://imagej.nih.gov/ij" class="uri">https://imagej.nih.gov/ij</a>) is a widely-used image viewing and processing software, particularly popular in microscopy and life sciences. It supports the TIFF image format (and many others). It reads TIFF files perfectly, however it can sometimes write them in a peculiar way, meaning that when other softwares try to read TIFF files written by <em>ImageJ</em>, mistakes can be made.</p>
<p>One goal of the <code>ijtiff</code> R package is to correctly import TIFF files that were saved from <em>ImageJ</em>.</p>
<div id="frames-and-channels-in-tiff-files" class="section level3">
<h3 class="hasAnchor">
<a href="#frames-and-channels-in-tiff-files" class="anchor"></a>Frames and Channels in TIFF files</h3>
<ul>
<li>In a volumetric image, <em>frames</em> are typically the different z-slices. In a time-stack of images (i.e. a video), each frame represents a time-point.</li>
<li>There is one <em>channel</em> per colour. A conventional colour image is made up of 3 colour channels: red, green and blue. A grayscale (black and white) image has just one channel. It’s possible to acquire two channels (e.g. red an blue but not green), five channels (e.g. infrared, red, green, blue and ultraviolet), or any number at all, but these cases are seen mostly in specialist imaging fields like microscopy.</li>
</ul>
</div>
<div id="the-peculiarity-of-imagej-tiff-files" class="section level3">
<h3 class="hasAnchor">
<a href="#the-peculiarity-of-imagej-tiff-files" class="anchor"></a>The Peculiarity of <em>ImageJ</em> TIFF files</h3>
<p>It is common to use <code>TIFFTAG_SAMPLESPERPIXEL</code> to record the number of channels in a TIFF image, however <em>ImageJ</em> sometimes leaves <code>TIFFTAG_SAMPLESPERPIXEL</code> with a value of 1 and instead encodes the number of channels in <code>TIFFTAG_IMAGEDESCRIPTION</code> which might look something like<br><code>"ImageJ=1.51 images=16 channels=2 slices=8"</code>.</p>
<p>A conventional TIFF reader would miss this channel information (because it is in an unusual place). <code>ijtiff</code> does not miss it. We’ll see an example below.</p>
<p><em>Note</em>: These peculiar <em>ImageJ</em>-written TIFF files are still bona fide TIFF files according to the TIFF specification. They just break with common conventions of encoding channel information.</p>
</div>
</div>
<div id="reading-imagej-tiff-files" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-imagej-tiff-files" class="anchor"></a>Reading <em>ImageJ</em> TIFF files</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">path_2ch_ij &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"img"</span>, <span class="st">"Rlogo-banana-red_green.tif"</span>, </a>
<a class="sourceLine" id="cb1-2" data-line-number="2">                           <span class="dt">package =</span> <span class="st">"ijtiff"</span>)</a></code></pre></div>
<p><code>path_2ch_ij</code> is the path to a TIFF file which was made in <em>ImageJ</em> from the R logo dancing banana GIF used in the README of Jeroen Ooms’ <code>magick</code> package. The TIFF is a time-stack containing only the red and green channels of the first, third and fifth frames of the original GIF. Here’s the full gif:</p>
<p><img src="the-imagej-problem_files/figure-html/magickally%20display%20gif-1.gif"><!-- --></p>
<p>Here are the red and green channels of the first, third and fifth frames of the TIFF:</p>
<p><img src="the-imagej-problem_files/figure-html/red%20and%20green%20banana-1.png" width="600"></p>
<div id="the-original-tiff-package" class="section level3">
<h3 class="hasAnchor">
<a href="#the-original-tiff-package" class="anchor"></a>The original <code>tiff</code> package</h3>
<p>When we import it with the original <code>tiff</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">img &lt;-<span class="st"> </span>tiff<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tiff/topics/readTIFF">readTIFF</a></span>(path_2ch_ij, <span class="dt">all =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#&gt; Warning in tiff::readTIFF(path_2ch_ij, all = TRUE): TIFFReadDirectory:</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Unknown field with tag 50838 (0xc696) encountered</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Warning in tiff::readTIFF(path_2ch_ij, all = TRUE): TIFFReadDirectory:</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Unknown field with tag 50839 (0xc697) encountered</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="kw">str</span>(img)  <span class="co"># 10 images</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; List of 6</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt;  $ : num [1:155, 1:200] 1 1 1 1 1 1 1 1 1 1 ...</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">img[[<span class="dv">1</span>]][<span class="dv">100</span><span class="op">:</span><span class="dv">110</span>, <span class="dv">50</span><span class="op">:</span><span class="dv">60</span>]  <span class="co"># print a section of the first image in the series</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;  [1,] 0.6627451 0.6627451 0.6549020 0.6627451 0.7058824 0.9215686</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt;  [2,] 0.6745098 0.6431373 0.6745098 0.6431373 0.6431373 0.6745098</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt;  [3,] 0.6549020 0.6627451 0.6431373 0.6627451 0.6627451 0.6431373</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt;  [4,] 0.6431373 0.6431373 0.6627451 0.6431373 0.6627451 0.6431373</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt;  [5,] 0.6745098 0.6745098 0.6431373 0.6627451 0.6431373 0.6627451</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;  [6,] 0.6745098 0.6431373 0.6431373 0.6431373 0.6549020 0.6549020</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt;  [7,] 0.6549020 0.6549020 0.6431373 0.6549020 0.6549020 0.6431373</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt;  [8,] 0.6431373 0.6549020 0.6431373 0.6549020 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt;  [9,] 0.6431373 0.6745098 0.6431373 0.6431373 0.6431373 0.6549020</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; [10,] 0.6431373 0.6549020 0.6431373 0.6549020 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-26" data-line-number="26"><span class="co">#&gt; [11,] 0.6431373 0.6431373 0.6431373 0.6431373 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-27" data-line-number="27"><span class="co">#&gt;            [,7]      [,8]      [,9]     [,10]     [,11]</span></a>
<a class="sourceLine" id="cb2-28" data-line-number="28"><span class="co">#&gt;  [1,] 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000</span></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="co">#&gt;  [2,] 0.8705882 1.0000000 1.0000000 1.0000000 1.0000000</span></a>
<a class="sourceLine" id="cb2-30" data-line-number="30"><span class="co">#&gt;  [3,] 0.6627451 0.7803922 1.0000000 1.0000000 1.0000000</span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="co">#&gt;  [4,] 0.6627451 0.6431373 0.7058824 0.9058824 1.0000000</span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32"><span class="co">#&gt;  [5,] 0.6431373 0.6627451 0.6431373 0.6431373 0.8039216</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="co">#&gt;  [6,] 0.6549020 0.6431373 0.6431373 0.6549020 0.6431373</span></a>
<a class="sourceLine" id="cb2-34" data-line-number="34"><span class="co">#&gt;  [7,] 0.6431373 0.6549020 0.6431373 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-35" data-line-number="35"><span class="co">#&gt;  [8,] 0.6549020 0.6431373 0.6549020 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-36" data-line-number="36"><span class="co">#&gt;  [9,] 0.6431373 0.6431373 0.6431373 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37"><span class="co">#&gt; [10,] 0.6431373 0.6431373 0.6431373 0.6431373 0.6431373</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"><span class="co">#&gt; [11,] 0.6549020 0.6431373 0.6431373 0.6431373 0.6431373</span></a></code></pre></div>
<ul>
<li>We just get a list of 6 frames, with no information about the channels.</li>
<li>We get annoying warnings about ImageJ’s private TIFF tags 50838 and 50839, which are of no interest to the <code>R</code> user.</li>
<li>The numbers in the image array(s) are (by default) normalized to the range [0, 1].</li>
</ul>
</div>
<div id="the-ijtiff-package" class="section level3">
<h3 class="hasAnchor">
<a href="#the-ijtiff-package" class="anchor"></a>The <code>ijtiff</code> package</h3>
<p>When we import the same image with the <code>ijtiff</code> package:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">img &lt;-<span class="st"> </span>ijtiff<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/ijtiff/topics/read_tif">read_tif</a></span>(path_2ch_ij)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; Reading Rlogo-banana-red_green.tif: an 8-bit, 155x200 pixel</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; image of unsigned integer type with 2 channels and 3 frames .</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; . .</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt;  Done.</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="kw">dim</span>(img)  <span class="co"># 2 channels, 3 frames</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; [1] 155 200   2   3</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">img[<span class="dv">100</span><span class="op">:</span><span class="dv">110</span>, <span class="dv">50</span><span class="op">:</span><span class="dv">60</span>, <span class="dv">1</span>, <span class="dv">1</span>]  <span class="co"># print a section of the first channel, first frame</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt;       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11]</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt;  [1,]  169  169  167  169  180  235  255  255  255   255   255</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;  [2,]  172  164  172  164  164  172  222  255  255   255   255</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt;  [3,]  167  169  164  169  169  164  169  199  255   255   255</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt;  [4,]  164  164  169  164  169  164  169  164  180   231   255</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt;  [5,]  172  172  164  169  164  169  164  169  164   164   205</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt;  [6,]  172  164  164  164  167  167  167  164  164   167   164</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt;  [7,]  167  167  164  167  167  164  164  167  164   164   164</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt;  [8,]  164  167  164  167  164  164  167  164  167   164   164</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="co">#&gt;  [9,]  164  172  164  164  164  167  164  164  164   164   164</span></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="co">#&gt; [10,]  164  167  164  167  164  164  164  164  164   164   164</span></a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="co">#&gt; [11,]  164  164  164  164  164  164  167  164  164   164   164</span></a></code></pre></div>
<ul>
<li>We see the image nicely represented as an array of channels of frames.</li>
<li>We get no needless warnings.</li>
<li>The numbers in the image are integers, the same as would be seen if one opened the image with ImageJ.</li>
</ul>
</div>
</div>
<div id="note" class="section level2">
<h2 class="hasAnchor">
<a href="#note" class="anchor"></a>Note</h2>
<p>The original <code>tiff</code> package reads several types of TIFFs correctly, including many that are saved from <em>ImageJ</em>. This is just an example of a TIFF type that it doesn’t perform so well with.</p>
</div>
<div id="advice-for-all-imagej-users" class="section level2">
<h2 class="hasAnchor">
<a href="#advice-for-all-imagej-users" class="anchor"></a>Advice for all <em>ImageJ</em> users</h2>
<p>Base <em>ImageJ</em> (similar to the <code>tiff</code> R package) does not properly open some perfectly good TIFF files<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> (including some TIFF files written by the <code>tiff</code> and <code>ijtiff</code> R packages). Instead it often gives you the error message: <em>imagej can only open 8 and 16 bit/channel images</em>. These images in fact can be opened in <em>ImageJ</em> using the wonderful <em>BioFormats</em> plugin. See <a href="https://imagej.net/Bio-Formats" class="uri">https://imagej.net/Bio-Formats</a>.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>I think native <em>ImageJ</em> only likes 1, 3 and 4-channel images and complains about the rest, but I’m not sure about this.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#reading-imagej-tiff-files">Reading <em>ImageJ</em> TIFF files</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#advice-for-all-imagej-users">Advice for all <em>ImageJ</em> users</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Rory Nolan, Kent Johnson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
